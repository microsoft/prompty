# Prompty TCK GitHub Actions Workflow

## Overview

The Promâ”œâ”€â”€ tck/
    â”œâ”€â”€ run-tck.sh                     # Main runner (Unix)
    â”œâ”€â”€ run-tck.ps1                    # Windows runner
    â”œâ”€â”€ python/run-tck.sh              # Python TCK
    â”œâ”€â”€ csharp/run-tck.sh              # C# TCK
    â”œâ”€â”€ interface/tck_interface.py     # Optional interface (for C# compatibility)
    â”œâ”€â”€ tools/compare_runtimes.py      # Comparison tool
    â”œâ”€â”€ tools/check_compatibility_threshold.py  # Threshold checker
    â”œâ”€â”€ validate-setup.py              # Setup validator
    â””â”€â”€ pre-commit-check.sh            # Pre-commit validationCompatibility Kit (TCK) now includes a comprehensive GitHub Actions workflow that automatically validates runtime compatibility across multiple platforms and runtime combinations.

## Key Features

### âœ… **Complete Automation**
- Runs on every push/PR to main branches
- Daily scheduled compatibility monitoring
- Manual workflow dispatch with custom parameters

### âœ… **Multi-Platform Testing**
- Ubuntu, Windows, and macOS support
- Python and C# runtime validation
- Cross-platform compatibility verification

### âœ… **Intelligent Reporting**
- Detailed compatibility reports (Markdown + JSON)
- Automatic PR comments with results
- GitHub Issues for compatibility regressions
- Test result summaries in GitHub Actions UI

### âœ… **Developer Experience**
- Pre-commit validation script (`./pre-commit-check.sh`)
- Setup validation tool (`python validate-setup.py`)
- PowerShell support for Windows (`.\run-tck.ps1`)
- Comprehensive documentation and examples

### âœ… **Artifact Management**
- 30-day retention for test results
- 90-day retention for compatibility reports
- Historical tracking and trend analysis
- GitHub Pages deployment option

### âœ… **Notification System**
- Slack/Teams webhook integration
- Automatic issue creation for regressions
- Email notifications via GitHub
- Customizable threshold monitoring

## Workflow Jobs

| Job | Purpose | Runs On |
|-----|---------|---------|
| `tck-matrix` | Core TCK testing across OS/runtime matrix | Ubuntu, Windows, macOS |
| `compatibility-report` | Generate cross-runtime compatibility analysis | Ubuntu |
| `runtime-specific-tests` | Validate runtime implementation standards | Ubuntu |
| `publish-results` | Deploy results to GitHub Pages and releases | Ubuntu |
| `notification` | Send alerts and create status summaries | Ubuntu |

## Setup Requirements

### Repository Structure
```
â”œâ”€â”€ .github/workflows/tck.yml          # Main workflow
â”œâ”€â”€ runtime/
â”‚   â”œâ”€â”€ prompty/                       # Python runtime
â”‚   â””â”€â”€ promptycs/                     # C# runtime
â””â”€â”€ tck/
    â”œâ”€â”€ run-tck.sh                     # Main runner (Unix)
    â”œâ”€â”€ run-tck.ps1                    # Windows runner
    â”œâ”€â”€ python/run-tck.sh              # Python TCK
    â”œâ”€â”€ csharp/run-tck.sh              # C# TCK
    â”œâ”€â”€ tools/compare_runtimes.py      # Comparison tool
    â”œâ”€â”€ tools/check_compatibility_threshold.py  # Threshold checker
    â”œâ”€â”€ validate-setup.py              # Setup validator
    â””â”€â”€ pre-commit-check.sh            # Pre-commit validation
```

### Optional Configuration
```yaml
# Repository secrets for enhanced features
SLACK_WEBHOOK_URL: https://hooks.slack.com/...
TEAMS_WEBHOOK_URL: https://outlook.office.com/webhook/...
```

## Usage Examples

### Local Development
```bash
# Validate setup
cd tck && python validate-setup.py

# Run pre-commit checks
./pre-commit-check.sh

# Test specific runtime
./run-tck.sh --runtime python

# Check compatibility
python tools/check_compatibility_threshold.py reports/compatibility-report.json
```

### Workflow Customization
```yaml
# Adjust compatibility threshold (in workflow)
threshold = 80.0

# Modify OS matrix
matrix:
  os: [ubuntu-latest, windows-latest, macos-latest]
  runtime: [python, csharp]

# Add exclusions to reduce CI time
exclude:
  - os: macos-latest
    runtime: csharp
```

## Sample Workflow Output

### PR Comment
```markdown
## ğŸ”„ Prompty TCK Compatibility Report

**Overall Compatibility Rate: 85.7%**

### Summary
- Total tests: 14
- Compatible tests: 12
- Incompatible tests: 2

### Runtime Matrix Results
âœ… Python on Ubuntu: 14/14 tests passed
âœ… C# on Ubuntu: 14/14 tests passed
âœ… Python on Windows: 14/14 tests passed
âš ï¸ C# on Windows: 12/14 tests passed

### Incompatible Tests
- `template-escaping`: Output format differences
- `unicode-handling`: Character encoding variations

---
ğŸ“Š *Generated by Prompty TCK Workflow*
```

### GitHub Issue (Auto-created for regressions)
```markdown
## ğŸš¨ TCK Compatibility Regression Detected (65.2%)

The Prompty TCK has detected a compatibility regression between runtime implementations.

**Current Compatibility Rate**: 65.2%
**Required Threshold**: 80%

### Action Required
1. Review the compatibility report
2. Identify which tests are failing across runtimes
3. Fix compatibility issues in the affected runtimes
4. Re-run the TCK to verify fixes

### Related
- Commit: abc123def
- Workflow: TCK Run #456
```

## Best Practices

### Development Workflow
1. **Always run locally first**: `./pre-commit-check.sh`
2. **Monitor compatibility trends**: Review daily reports
3. **Address regressions quickly**: Fix issues as they arise
4. **Update tests regularly**: Add coverage for new features

### Maintenance
- **Update OS versions** in matrix annually
- **Adjust thresholds** based on project maturity
- **Monitor CI costs** and optimize exclusions
- **Review notification settings** for team preferences

## Troubleshooting

### Common Issues

**Build Failures:**
- Check .NET/Python versions in workflow
- Verify runtime dependencies
- Review build logs in GitHub Actions

**Compatibility Regressions:**
- Run TCK locally to reproduce
- Use comparison tools for detailed analysis
- Focus on output format standardization

**Workflow Permissions:**
- Ensure Actions are enabled for repository
- Verify GITHUB_TOKEN has required permissions
- Check organization workflow restrictions

### Getting Help

- **Documentation**: [`tck/IMPLEMENTATION.md`](./IMPLEMENTATION.md)
- **Local validation**: `python validate-setup.py`
- **Setup guide**: [`tck/README.md`](./README.md)
- **Issue tracker**: Create GitHub issue with `tck` label

## Implementation Status

| Feature | Status | Notes |
|---------|--------|-------|
| Multi-platform testing | âœ… Complete | Ubuntu, Windows, macOS |
| Python TCK | âœ… Complete | Simplified implementation without interface dependency |
| C# TCK | âœ… Complete | .NET 9.0 compatible, uses interface for standardization |
| Compatibility reporting | âœ… Complete | Markdown + JSON formats |
| PR integration | âœ… Complete | Auto-comments and artifacts |
| Threshold monitoring | âœ… Complete | Configurable thresholds |
| Issue automation | âœ… Complete | Auto-creation for regressions |
| Documentation | âœ… Complete | Comprehensive guides |
| Pre-commit validation | âœ… Complete | Local developer tools |
| Windows support | âœ… Complete | PowerShell runner |

The TCK workflow is production-ready and provides comprehensive automation for maintaining runtime compatibility across the Prompty ecosystem.
